<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‰´í‚¤ì¦ˆ - í•™ë¶€ëª¨ ê²Œì‹œíŒ</title>
    <style>
        /* [ìŠ¤íƒ€ì¼] */
        * { box-sizing: border-box; }
        body { font-family: 'Pretendard', sans-serif; background: #f0f2f5; margin: 0; padding: 20px; }
        
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 40px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.05); }
        
        /* í—¤ë” ì˜ì—­ */
        .board-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #1a3c6e; padding-bottom: 20px; margin-bottom: 20px; }
        .board-title { color: #1a3c6e; font-size: 1.8rem; font-weight: bold; }
        .btn-logout { background: #666; color: #fff; padding: 8px 20px; border-radius: 5px; cursor: pointer; border: none; font-weight: bold; }
        .btn-logout:hover { background: #444; }

        /* ê²Œì‹œíŒ í…Œì´ë¸” */
        .board-table { width: 100%; border-collapse: collapse; font-size: 0.95rem; }
        .board-table th { background: #f8f9fa; padding: 15px; border-bottom: 2px solid #ddd; color: #555; font-weight: bold; text-align: center; }
        .board-table td { padding: 15px; border-bottom: 1px solid #eee; color: #333; text-align: center; }
        
        /* ì œëª©ì€ ì™¼ìª½ ì •ë ¬ + í´ë¦­ ê°€ëŠ¥í•˜ê²Œ */
        .board-table td.title-col { text-align: left; cursor: pointer; color: #1a3c6e; font-weight: 500; }
        .board-table td.title-col:hover { text-decoration: underline; color: #f4a261; }
        
        /* ëª¨ë°”ì¼ ëŒ€ì‘ */
        @media (max-width: 600px) {
            .board-table th:nth-child(1), .board-table td:nth-child(1), /* ë²ˆí˜¸ ìˆ¨ê¹€ */
            .board-table th:nth-child(3), .board-table td:nth-child(3), /* ì‘ì„±ì ìˆ¨ê¹€ */
            .board-table th:nth-child(4), .board-table td:nth-child(4) { display: none; } /* ë‚ ì§œ ìˆ¨ê¹€ */
            .board-title { font-size: 1.4rem; }
        }

        /* íŒì—…(ëª¨ë‹¬) ìŠ¤íƒ€ì¼ - ê¸€ ë‚´ìš© ë³´ê¸° */
        #post-modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); }
        .modal-content { background-color: #fff; margin: 10% auto; padding: 30px; border-radius: 10px; width: 90%; max-width: 600px; position: relative; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .close-btn { position: absolute; top: 15px; right: 20px; font-size: 24px; cursor: pointer; color: #aaa; }
        .close-btn:hover { color: #000; }
        
        .modal-header { border-bottom: 1px solid #eee; padding-bottom: 15px; margin-bottom: 20px; }
        .modal-title { font-size: 1.4rem; font-weight: bold; color: #1a3c6e; margin-bottom: 10px; }
        .modal-meta { font-size: 0.9rem; color: #888; }
        .modal-body { line-height: 1.8; color: #333; min-height: 150px; white-space: pre-line; /* ì¤„ë°”ê¿ˆ ì ìš© */ }
    </style>
</head>
<body>

    <div class="container">
        <div class="board-header">
            <div class="board-title">ğŸ“¢ í•™ë¶€ëª¨ ì•Œë¦¼ì¥</div>
            <button class="btn-logout" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
        </div>

        <p style="margin-bottom: 20px; color: #666;">
            ì•„ì´ë“¤ì˜ í™œë™ ì†Œì‹ê³¼ ê³µì§€ì‚¬í•­ì„ í™•ì¸í•˜ì„¸ìš”. (ì‘ì„±ëœ ê¸€ì„ í´ë¦­í•˜ë©´ ë‚´ìš©ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.)
        </p>

        <table class="board-table">
            <thead>
                <tr>
                    <th width="10%">ë²ˆí˜¸</th>
                    <th width="50%">ì œëª©</th>
                    <th width="20%">ì‘ì„±ì</th>
                    <th width="20%">ë‚ ì§œ</th>
                </tr>
            </thead>
            <tbody id="board-list">
                <tr>
                    <td colspan="4" style="padding: 30px;">ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div id="post-modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal()">&times;</span>
            <div class="modal-header">
                <div class="modal-title" id="m-title">ì œëª©</div>
                <div class="modal-meta" id="m-meta">ë‚ ì§œ | ì‘ì„±ì</div>
            </div>
            <div class="modal-body" id="m-body">
                ë‚´ìš©ì´ ì—¬ê¸°ì— ë‚˜ì˜µë‹ˆë‹¤.
            </div>
        </div>
    </div>

    <script>
        // [1] ë¡œê·¸ì¸ ì²´í¬ (ê³µìš© ë¹„ë°€ë²ˆí˜¸ ë°©ì‹)
        if (sessionStorage.getItem("isParent") !== "true") {
            alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
            window.location.href = "login.html";
        }

        // [2] ì—‘ì…€ ê²Œì‹œíŒ ë°ì´í„° ì£¼ì†Œ (â˜…ì—¬ê¸°ì— ë³µì‚¬í•œ ì£¼ì†Œë¥¼ ë„£ìœ¼ì„¸ìš”â˜…)
        const BOARD_SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSN8NdA-JjKfu9o4yDerh-yIRyxZwqiqWNiibSCRPfmk9DYz370uAOq_H9A1oUDLDi6olVwHAi52Qth/pub?gid=0&single=true&output=csv";

        // [3] ê²Œì‹œê¸€ ë¶ˆëŸ¬ì˜¤ê¸° í•¨ìˆ˜
        async function loadBoard() {
            try {
                const response = await fetch(BOARD_SHEET_URL);
                const data = await response.text();
                const rows = data.split("\n").slice(1); // ì²« ì¤„(ì œëª©) ì œì™¸

                const boardList = document.getElementById('board-list');
                boardList.innerHTML = ""; // ë¡œë”© ë¬¸êµ¬ ì§€ìš°ê¸°

                // ìµœì‹  ê¸€ì´ ìœ„ë¡œ ì˜¤ê²Œ (ë°°ì—´ ë’¤ì§‘ê¸°)
                rows.reverse().forEach((row, index) => {
                    if(row.trim() === "") return;

                    // ì—‘ì…€ ì¹¸ ë‚˜ëˆ„ê¸° (ë”°ì˜´í‘œ ì²˜ë¦¬ í¬í•¨)
                    const cols = parseCSVRow(row);
                    
                    // A:ë²ˆí˜¸, B:ì œëª©, C:ë‚ ì§œ, D:ì‘ì„±ì, E:ë‚´ìš©
                    const no = cols[0];
                    const title = cols[1];
                    const date = cols[2];
                    const writer = cols[3];
                    const content = cols[4];

                    // í…Œì´ë¸”ì— í–‰ ì¶”ê°€
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${no}</td>
                        <td class="title-col" onclick="openModal('${title}', '${writer}', '${date}', \`${content}\`)">${title}</td>
                        <td>${writer}</td>
                        <td>${date}</td>
                    `;
                    boardList.appendChild(tr);
                });

            } catch (error) {
                console.error(error);
                document.getElementById('board-list').innerHTML = `<tr><td colspan="4">ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</td></tr>`;
            }
        }

        // CSV íŒŒì‹± í•¨ìˆ˜ (ì½¤ë§ˆ ì•ˆì— ìˆëŠ” ì½¤ë§ˆ ì²˜ë¦¬ìš©)
        function parseCSVRow(row) {
            const result = [];
            let current = '';
            let inQuote = false;
            for (let i = 0; i < row.length; i++) {
                const char = row[i];
                if (char === '"') { inQuote = !inQuote; }
                else if (char === ',' && !inQuote) {
                    result.push(current.trim()); current = '';
                } else { current += char; }
            }
            result.push(current.trim());
            return result;
        }

        // [4] ëª¨ë‹¬(íŒì—…) ê´€ë ¨ í•¨ìˆ˜
        function openModal(title, writer, date, content) {
            document.getElementById('m-title').innerText = title;
            document.getElementById('m-meta').innerText = `ì‘ì„±ì¼: ${writer} | ì‘ì„±ì: ${date}`;
            
            // ì—‘ì…€ì—ì„œ ì¤„ë°”ê¿ˆì´ ê¹¨ì§€ì§€ ì•Šë„ë¡ ì²˜ë¦¬
            const cleanContent = content.replace(/^"|"$/g, '').replace(/\\n/g, '\n');
            document.getElementById('m-body').innerText = cleanContent;
            
            document.getElementById('post-modal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('post-modal').style.display = 'none';
        }

        // ë°”ê¹¥ í´ë¦­ ì‹œ ë‹«ê¸°
        window.onclick = function(event) {
            if (event.target == document.getElementById('post-modal')) {
                closeModal();
            }
        }

        function logout() {
            sessionStorage.removeItem("isParent");
            window.location.href = "index.html";
        }

        // í˜ì´ì§€ ì‹œì‘ ì‹œ ê²Œì‹œê¸€ ë¡œë”©
        loadBoard();
    </script>

</body>
</html>